Live coding Clojure + LWJGL (What Minecraft Java runs on)

10,000 rectangles updating instantly.

No restarts. No reloads.

Just poking the scene and watching it change in real time.

* Run
- Run: =clj -M:run=
- When running, an nREPL server starts and prints its port.
- LearnOpenGL Chapter 1 (hello window) example (basic GLFW window with clear color): =clj -M:hello-window=
- LearnOpenGL Chapter 1 (hello window clear) example (dynamic clear color): =clj -M:hello-window-clear=
- LearnOpenGL Chapter 1 (hello triangle) example (basic OpenGL triangle render): =clj -M:chapter1=
- LearnOpenGL Chapter 1 (indexed triangle) example (EBO + two triangles quad): =clj -M:triangle-indexed=
- LearnOpenGL Chapter 1 (triangle exercise 1) example (two triangles, single VAO/VBO): =clj -M:triangle-ex1=
- LearnOpenGL Chapter 1 (triangle exercise 2) example (two triangles, separate VAOs/VBOs): =clj -M:triangle-ex2=
- LearnOpenGL Chapter 1 (triangle exercise 3) example (two fragment shaders: orange/yellow): =clj -M:triangle-ex3=
- LearnOpenGL Chapter 1 (triangle input) example (WASD move, Q/E rotate, mouse drag to reposition): =clj -M:triangle-input=
- LearnOpenGL Chapter 1 (triangle rainbow) example (rainbow shader, mouse X shifts hue, Z/X mix factor): =clj -M:triangle-rainbow=
- LearnOpenGL Chapter 1 (shaders uniform) example (animated uniform color): =clj -M:shaders-uniform=
- LearnOpenGL Chapter 1 (shaders interpolation) example (vertex color interpolation): =clj -M:shaders-interpolation=
- LearnOpenGL Chapter 1 (shaders class) example (load shaders from resources): =clj -M:shaders-class=
- LearnOpenGL Chapter 1 (shaders exercise 1) example (invert Y via vertex shader): =clj -M:shaders-ex1=
- LearnOpenGL Chapter 1 (shaders exercise 2) example (constant yellow fragment color): =clj -M:shaders-ex2=
- LearnOpenGL Chapter 1 (shaders exercise 3) example (custom attribute layout/name): =clj -M:shaders-ex3=
- LearnOpenGL Chapter 1 (textures) example (single procedural texture on quad): =clj -M:textures=
- LearnOpenGL Chapter 1 (textures combined) example (two procedural textures mixed): =clj -M:textures-combined=
- LearnOpenGL Chapter 1 (textures exercise 1) example (flip second texture in mix): =clj -M:textures-ex1=
- LearnOpenGL Chapter 1 (textures exercise 2) example (adjust mix factor with arrow keys): =clj -M:textures-ex2=
- LearnOpenGL Chapter 1 (textures exercise 3) example (rotate texture coordinates 90°): =clj -M:textures-ex3=
- LearnOpenGL Chapter 1 (textures exercise 4) example (clamp-to-border sampling): =clj -M:textures-ex4=
- LearnOpenGL Chapter 1 (transformations) example (translate/rotate textured quad): =clj -M:transformations=
- LearnOpenGL Chapter 1 (transformations exercise 1) example (two quads with differing transforms): =clj -M:transformations-ex1=
- LearnOpenGL Chapter 1 (transformations exercise 2) example (animated rotation + scaling): =clj -M:transformations-ex2=
- LearnOpenGL Chapter 1 (coordinate systems) example (single rotating cube with perspective): =clj -M:coordinate-systems=
- LearnOpenGL Chapter 1 (coordinate systems depth) example (two cubes showing depth test): =clj -M:coordinate-systems-depth=
- LearnOpenGL Chapter 1 (coordinate systems multiple) example (multiple cubes with transforms): =clj -M:coordinate-systems-multiple=
- LearnOpenGL Chapter 1 (coordinate systems exercise 3) example (orbital camera around cubes): =clj -M:coordinate-systems-ex3=
- LearnOpenGL Chapter 1 (camera circle) example (orbiting camera view): =clj -M:camera-circle=
- LearnOpenGL Chapter 1 (camera keyboard dt) example (WASD camera movement with delta time): =clj -M:camera-keyboard-dt=
- LearnOpenGL Chapter 1 (camera mouse zoom) example (mouse look + scroll zoom): =clj -M:camera-mouse-zoom=
- LearnOpenGL Chapter 1 (camera class) example (camera controls via reusable state): =clj -M:camera-class=
- LearnOpenGL Chapter 1 (camera exercise 1) example (grounded FPS-style camera): =clj -M:camera-exercise1=
- LearnOpenGL Chapter 1 (camera exercise 2) example (manual LookAt matrix): =clj -M:camera-exercise2=
- LearnOpenGL Chapter 1 (tetrahedron input) example (WASD/QE rotate, mouse drag rotate): =clj -M:tetrahedron-input=
- LearnOpenGL Chapter 1 (tetrahedron translucent) example (WASD/QE rotate, Z/X scale, C/V alpha, scroll scale): =clj -M:tetrahedron-translucent=
- LearnOpenGL Chapter 1 (cube input) example (WASD/QE rotate, Z/X scale, scroll scale): =clj -M:cube-input=
- LearnOpenGL Chapter 2 (colors) example (basic ambient + diffuse lighting): =clj -M:colors=
- LearnOpenGL Chapter 2 (basic lighting diffuse) example (Lambert diffuse + ambient): =clj -M:basic-lighting-diffuse=
- LearnOpenGL Chapter 2 (basic lighting specular) example (adds Phong specular): =clj -M:basic-lighting-specular=
- LearnOpenGL Chapter 2 (basic lighting exercise 1) example (animated light color): =clj -M:basic-lighting-ex1=
- LearnOpenGL Chapter 2 (basic lighting exercise 2) example (animated light color + specular): =clj -M:basic-lighting-ex2=
- LearnOpenGL Chapter 2 (basic lighting exercise 3) example (per-vertex/Gouraud shading): =clj -M:basic-lighting-ex3=
- LearnOpenGL Chapter 2 (materials) example (material/lighting structs): =clj -M:materials=
- LearnOpenGL Chapter 2 (materials exercise 1) example (changing light/material colors): =clj -M:materials-ex1=
- LearnOpenGL Chapter 2 (lighting maps diffuse) example (textured diffuse lighting): =clj -M:lighting-maps-diffuse=
- LearnOpenGL Chapter 2 (lighting maps specular) example (specular map highlights): =clj -M:lighting-maps-specular=
- LearnOpenGL Chapter 2 (lighting maps exercise 2) example (rotating textured cube with specular map): =clj -M:lighting-maps-ex2=
- LearnOpenGL Chapter 2 (lighting maps exercise 4) example (emission textured highlights): =clj -M:lighting-maps-ex4=
- LearnOpenGL Chapter 2 (light casters directional) example (directional light): =clj -M:light-casters-directional=
- LearnOpenGL Chapter 2 (light casters point) example (point light with attenuation): =clj -M:light-casters-point=
- LearnOpenGL Chapter 2 (light casters spot) example (sharp spotlight): =clj -M:light-casters-spot=
- LearnOpenGL Chapter 2 (light casters spot soft) example (soft-edged spotlight): =clj -M:light-casters-spot-soft=
- LearnOpenGL Chapter 2 (multiple lights) example (directional + point + spotlight): =clj -M:multiple-lights=
- LearnOpenGL Chapter 2 (multiple lights exercise 1) example (colored point lights): =clj -M:multiple-lights-ex1=
- LearnOpenGL Chapter 3 (model loading) example (Assimp import, animated rotation): =clj -M:model-loading=
- LearnOpenGL Chapter 5 (advanced lighting dispatch) example: =clj -M:advanced-lighting <scenario>= (scenarios: =advanced_lighting=, =gamma_correction=, =shadow_mapping_depth=, =shadow_mapping_base=, =shadow_mapping=, =point_shadows=, =point_shadows_soft=, =csm=, =normal_mapping=, =parallax_mapping=, =steep_parallax_mapping=, =parallax_occlusion_mapping=, =hdr=, =bloom=, =deferred_shading=, =deferred_shading_volumes=, =ssao=)

* Chapter 1 migration TODO
- [x] 1.1.hello_window
- [x] 1.2.hello_window_clear
- [x] 2.1.hello_triangle
- [x] 2.2.hello_triangle_indexed
- [x] 2.3.hello_triangle_exercise1
- [x] 2.4.hello_triangle_exercise2
- [x] 2.5.hello_triangle_exercise3
- [x] 3.1.shaders_uniform
- [x] 3.2.shaders_interpolation
- [x] 3.3.shaders_class
- [x] 3.4.shaders_exercise1
- [x] 3.5.shaders_exercise2
- [x] 3.6.shaders_exercise3
- [x] 4.1.textures
- [x] 4.2.textures_combined
- [x] 4.3.textures_exercise1
- [x] 4.4.textures_exercise2
- [x] 4.5.textures_exercise3
- [x] 4.6.textures_exercise4
- [x] 5.1.transformations
- [x] 5.2.transformations_exercise1
- [x] 5.3.transformations_exercise2
- [x] 6.1.coordinate_systems
- [x] 6.2.coordinate_systems_depth
- [x] 6.3.coordinate_systems_multiple
- [x] 6.4.coordinate_systems_exercise3
- [x] 7.1.camera_circle
- [x] 7.2.camera_keyboard_dt
- [x] 7.3.camera_mouse_zoom
- [x] 7.4.camera_class
- [x] 7.5.camera_exercise1
- [x] 7.6.camera_exercise2

* Chapter 2 migration TODO (Lighting)
- [x] 1.colors
- [x] 2.1.basic_lighting_diffuse
- [x] 2.2.basic_lighting_specular
- [x] 2.3.basic_lighting_exercise1
- [x] 2.4.basic_lighting_exercise2
- [x] 2.5.basic_lighting_exercise3
- [x] 3.1.materials
- [x] 3.2.materials_exercise1
- [x] 4.1.lighting_maps_diffuse_map
- [x] 4.2.lighting_maps_specular_map
- [x] 4.3.lighting_maps_exercise2
- [x] 4.4.lighting_maps_exercise4
- [x] 5.1.light_casters_directional
- [x] 5.2.light_casters_point
- [x] 5.3.light_casters_spot
- [x] 5.4.light_casters_spot_soft
- [x] 6.multiple_lights
- [x] 6.multiple_lights_exercise1

* Chapter 3 migration TODO (Model Loading)
- [x] 3.1.model_loading

* Chapter 4 migration TODO (Advanced OpenGL)
- [x] 1.1.depth_testing
- [x] 1.2.depth_testing_view
- [x] 2.stencil_testing
- [x] 3.1.blending_discard
- [x] 3.2.blending_sort
- [x] 4.face_culling_exercise1
- [x] 5.1.framebuffers
- [x] 5.2.framebuffers_exercise1
- [x] 6.1.cubemaps_skybox
- [x] 6.2.cubemaps_environment_mapping
- [x] 8.advanced_glsl_ubo
- [x] 9.1.geometry_shader_houses
- [x] 9.2.geometry_shader_exploding
- [x] 9.3.geometry_shader_normals
- [x] 10.1.instancing_quads
- [x] 10.2.asteroids
- [x] 10.3.asteroids_instanced
- [x] 11.1.anti_aliasing_msaa
- [x] 11.2.anti_aliasing_offscreen

* Chapter 5 migration TODO (Advanced Lighting)
- [x] 1.advanced_lighting
- [x] 2.gamma_correction
- [x] 3.1.1.shadow_mapping_depth
- [x] 3.1.2.shadow_mapping_base
- [x] 3.1.3.shadow_mapping
- [x] 3.2.1.point_shadows
- [x] 3.2.2.point_shadows_soft
- [x] 3.3.csm
- [x] 4.normal_mapping
- [x] 5.1.parallax_mapping
- [x] 5.2.steep_parallax_mapping
- [x] 5.3.parallax_occlusion_mapping
- [x] 6.hdr
- [x] 7.bloom
- [x] 8.1.deferred_shading
- [x] 8.2.deferred_shading_volumes
- [x] 9.ssao

* Chapter 6 migration TODO (PBR)
- [ ] 1.1.lighting
- [ ] 1.2.lighting_textured
- [ ] 2.1.1.ibl_irradiance_conversion
- [ ] 2.1.2.ibl_irradiance
- [ ] 2.2.1.ibl_specular
- [ ] 2.2.2.ibl_specular_textured

* Chapter 7 migration TODO (In Practice)
- [ ] 1.debugging
- [ ] 2.text_rendering
- [ ] 3.2d_game/0.full_source

* Chapter 8 migration TODO (Guest)
- [ ] 2020
- [ ] 2021
- [ ] 2022

* Notes
- The project is configured for macOS arm64 natives in =deps.edn=.
- On Intel macOS, use =natives-macos= instead of =natives-macos-arm64= in the =$classifier= lib names.
- For Windows or Linux, replace with the matching classifier.
- LWJGL 3.3.x is tested against LTS JDKs; use Java 17/21 if you hit JNI warnings on newer JDKs.
- The upstream LearnOpenGL examples are available as a submodule at =./LearnOpenGL= for reference.
- Source code is organized by chapter under =src/lwjgl/chapterN= to mirror the LearnOpenGL structure.

* Live REPL
- Discover port: =clj-nrepl-eval --discover-ports=
- Example tweak: =clj-nrepl-eval -p <port> "(swap! lwjgl.core/osc-amplitude (constantly 0.15))"=
- Toggle wireframe: press =W= in the window.
- Toggle instancing (single rectangle debug): press =I= in the window.

* Kons-9 展示教程
** 运行（带 nREPL）
- 推荐：=./run.sh hotreload-nrepl=
- Intel macOS：=clj -M:natives-intel:hotreload=

** 快捷键（hotreload 窗口）
- 1-7 切换内置场景
- 0 启动默认演示时间线
- P 暂停/恢复
- M 切换手动播放模式（按住空格播放）
- D 重置当前场景

** 连接 REPL 与加载
#+begin_src clojure
(require 'lwjgl.experiment.kons9.dsl :reload)
(require 'lwjgl.experiment.kons9.api :reload)
#+end_src

** 内置场景与时间线
#+begin_src clojure
(require '[lwjgl.experiment.kons9.api :as k])

(k/scene-list)          ;; 查看场景
(k/scene! :sdf)         ;; 切换场景
(k/start-demo!)         ;; 默认时间线
(k/stop-demo!)
#+end_src

- 可展示场景：
  - :baseline（基础坐标轴与网格）
  - :geometry（基础几何/点云/球体）
  - :rig（层级结构 + 关节动画）
  - :sweep（扫掠网格）
  - :particles（粒子点云）
  - :sdf（SDF 等值面）
  - :spring（弹簧网格）
  - :ecosystem（生态系统）
  - :live（自定义 live 场景）

** 迁移函数可视化速查
*** 曲线/点云 -> =k/points!=
#+begin_src clojure
(require '[lwjgl.experiment.kons9.api :as k])

(k/points! (k/line-curve [0 0 0] [1 1 0] 16))
(k/points! (k/circle-curve 2.0 64))
(k/points! (k/arc-curve 2.0 0 180 32))
(k/points! (k/spiral-curve 0.2 2.0 -1.0 4 128))
(k/points! (k/sine-curve 360 1.0 2.0 1.0 128))
(k/points! (k/bezier-curve [0 0 0] [1 2 0] [2 -1 0] [3 0 0] 64))
(k/points! (k/butterfly-curve 256))
(k/points! (k/hypotrochoid-curve 7 3 2.5 256))
(k/points! (k/epitrochoid-curve 7 3 2.5 256))
(k/points! (k/random-points 200 [-1 -1 -1] [1 1 1]))
(k/points! (k/grid-points 8 1 8 [-1 0 -1] [1 0 1]))
#+end_src

*** 多面体 -> =k/polyhedron->mesh= + =k/mesh!=
#+begin_src clojure
(let [poly (k/cube-polyhedron 2.0)
      poly2 (k/refine-polyhedron poly 2)
      {:keys [vertices indices]} (k/polyhedron->mesh poly2)]
  (k/mesh! vertices indices))

(let [poly (k/icosahedron-polyhedron 2.0)
      poly2 (k/smooth-polyhedron poly 2)
      {:keys [vertices indices]} (k/polyhedron->mesh poly2)]
  (k/mesh! vertices indices))

(let [poly (k/cube-polyhedron 2.0)
      poly2 (k/fractalize-polyhedron poly 3 0.5)
      {:keys [vertices indices]} (k/polyhedron->mesh poly2)]
  (k/mesh! vertices indices))
#+end_src

*** 多面体原型与变体（直接展示）
#+begin_src clojure
;; 基础多面体
(let [{:keys [vertices indices]} (k/tetrahedron-mesh 2.0)]
  (k/mesh! vertices indices))

(let [{:keys [vertices indices]} (k/octahedron-mesh 2.0)]
  (k/mesh! vertices indices))

(let [{:keys [vertices indices]} (k/dodecahedron-mesh 2.0)]
  (k/mesh! vertices indices))

(let [{:keys [vertices indices]} (k/icosahedron-mesh 2.0)]
  (k/mesh! vertices indices))

;; 盒子与切角立方体（polyhedron -> mesh）
(let [poly (k/box-polyhedron 2.0 1.2 0.8)
      {:keys [vertices indices]} (k/polyhedron->mesh poly)]
  (k/mesh! vertices indices))

(let [poly (k/cut-cube-polyhedron 2.0)
      {:keys [vertices indices]} (k/polyhedron->mesh poly)]
  (k/mesh! vertices indices))
#+end_src

*** 直接网格 -> =k/mesh!=
#+begin_src clojure
(let [{:keys [vertices indices]} (k/uv-sphere 24 36)]
  (k/mesh! vertices indices))

(let [{:keys [vertices indices]} (k/sweep-mesh :segments 80 :ring 16 :length 3.0)]
  (k/mesh! vertices indices))

(let [{:keys [vertices indices]} (k/cube-mesh 2.0)]
  (k/mesh! vertices indices))
#+end_src

*** 细分/分型参数建议
- refine: =levels= 建议 1-3（超过 3 顶点数快速增长）
- smooth: 适合二十面体/十二面体，细分 1-2 层即可明显圆润
- fractalize: =displacement= 建议 0.2~0.8，层数 2-3

*** SDF/等值面
#+begin_src clojure
(k/metaballs!)  ;; 默认参数
#+end_src

*** 精灵（透明排序）
#+begin_src clojure
(require '[lwjgl.experiment.hotreload :as hr])

(hr/set-sprite-style! {:size 18.0 :alpha 0.7 :softness 0.15})
(hr/set-sprites! (k/sphere-point-cloud 200 1.2))
#+end_src

*** 点云 vs 精灵 对比
#+begin_src clojure
;; 点云：GPU 点
(k/points! (k/sphere-point-cloud 200 1.2))

;; 精灵：带透明混合的 billboard
(require '[lwjgl.experiment.hotreload :as hr])
(hr/set-sprite-style! {:size 14.0 :alpha 0.65 :softness 0.2})
(hr/set-sprites! (k/sphere-point-cloud 200 1.2))
#+end_src

*** 手动播放模式与场景重置
#+begin_src clojure
(require '[lwjgl.experiment.hotreload :as hr])

;; 切换到手动播放（空格按住播放）
(hr/set-manual-play! true)

;; 重置当前场景（时间与状态）
(hr/reset-scene!)
#+end_src

** Live 场景（自定义展示）
#+begin_src clojure
(k/live!
 {:build (fn [{:keys [t]} _]
           [(k/cube-node :pos [0 0 0]
                         :rot [0 (* 60.0 (Math/sin t)) 0]
                         :scale [0.5 0.5 0.5]
                         :color [0.9 0.4 0.2])
            (k/group-node
             :pos [0 0 0]
             :rot [0 (* 30.0 (Math/sin (* 0.5 t))) 0]
             :children
             [(k/mesh-node :mesh (k/uv-sphere 24 36)
                           :style {:color [0.7 0.7 0.95]})])])})
#+end_src

** 动画曲线
#+begin_src clojure
;; 线性插值
(def lift (k/anim :from 0.0 :to 1.2 :duration 2.0 :ease :smoothstep))

;; 正弦振荡
(def rot-y (k/osc :amp 45.0 :freq 0.2))

;; 关键帧 + 曲线插值
(def swing (k/keyframes [[0 [0 0 0]]
                         [1 [20 0 0]]
                         [2 [0 0 0]]]
                        :loop? true
                        :interp :catmull))

;; 贝塞尔缓动
(def ease (k/bezier-ease [0.42 0.0] [0.58 1.0]))
(def spin (k/anim :from 0 :to 180 :duration 3.0 :ease ease))
#+end_src

** 常用清理
#+begin_src clojure
(k/clear-points!)
(k/clear-mesh!)
(k/cube-clear!)
(k/scene! :baseline)
#+end_src

* CIDER
- Start the app with CIDER middleware: =clj -M:run:cider-deps=
- In Emacs, run =cider-connect= to the port in =.nrepl-port=.
- Live tweak example: =(reset! lwjgl.core/rect-color [0.9 0.2 0.2])=
- Alternative: =clj -M:cider= then =(lwjgl.core/run-app!)= from the REPL.
